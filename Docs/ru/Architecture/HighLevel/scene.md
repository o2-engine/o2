## Сцена
Сцена является еще одной подсистемой движка, в которой используются низкоуровенвые системы.

Сцена состоит из иерархии акторов и слоев. Она может быть загружена и выгружена, может быть изменена в рантайме.

### Иерархия
У каждого актора могут быть акторы-дети. У них в свою очередь тоже могут быть дети. В сцене хранится список "рутовых" акторов. Таким образом получается иерархия акторов на сцене.

Акторы могут быть разных типов, наследуясь от базового `o2::Actor`. 

На акторах могут быть компоненты. Компоненты определяют логику актора, могут быть отрисовываемыми.

Если компонент отрисовывается, он принажделит какому-то слою и имеет приоритет отрисовки.

### Слои
Сцена разделена на слои. Эти слои задают порядок отрисовки сцены. Порядок слоев задается разработчиком, список слоев и их имена тоже.

Рисуемые сущности распределяются по слоям, одна сущность может быть только на одном слое.

Внутри слоя сущности сортируются по приоритетам.

### Актор, o2::Actor
Это базовый элемент сцены. У него есть имя, трансформация, список детей и список компонент. Акторы могут быть разных типов, унаследованных от `o2::Actor`.

У акторов есть цикл жизни:
- `constructor` - конструктор актора
- `deserialization` - десериализация данных актора. ПРоисходит автоматически
- `OnDeserialized` - коллбек на завершение десериализации
- `OnAddToScene`/`RemovedFromScene` - добавление/удаление из сцены
- `OnStart` - старт актора, перед первым апдейтом
- `OnEnabled`/`Disabled` - включение/выключение актора
- `Update` - обновление актора и компонент
- `OnTransformUpdated`/`Changed` - обновление и изменение трансформации

### Компонент, o2::Component
Все компоненты наследуются от этого общего интерфейса. Внутри компоненты задается какая-то логика, которая может взаимодействовать с другими частями сцены и ассетами через ссылки.

У компонентов, как и у акторов, тоже есть такие же ивенты и цикл жизни: конструктор, десериализация, старт, обновление и тп.

### Рисуемый компонент, o2::DrawableComponent
Этот интерфейс определяет что компонент может что-то рисовать на сцене. В нем определяется слой и индекс сортировки. Чем он больше, тем позднее он отрисуется в выбранном слое.

Индекс сортировки не обязателен, он может быть унаследован от родителя. В таком случае родитель при отрисовки себя нарисует и эту сущность. Если таких сущностей несколько у родителя, он нарисует их в порядке расположения в иерархии.

Если родителя нет, то объект помещается в специальный контейнер слоя с приоритетом 0, в котором подобные сущности рисуются так же в порядке расположения в иерархии.

Таким образом, если задать отрицательный индекс, то компонент будет отрисован ранее других компонентов, у которых индекс не задан, тк он будет нулевым.

По умолчанию индекс сортировки не задан и используется родительский. То есть сцена рисуется в порядке обхода иерархии.

### Прототипы
Для ускорения создания сцены и удобства работы в сцене можно использовать прототипы. Это такие предзаготовленные куски иерархии сцены, фактически актор с его детьми, который затем можно "инстанцировать" на сцену, т.е. создать его копию.

При этом, если в редакторе на сцене что-то поменять в одном из инстансов прототипа, то можно это изменение применить к базовому прототипу, и все остальные инстансы получат такое же изменение. Но это работает только в редакторе.

Прототипы можно создавать от прототипов, изменяя какие-либо его параметры. Тогда на конечном инстансе унаследованного прототипа будут отображаться изменения как базового прототипа, так и унаследованного

### Ссылки
Для связа компонет, акторов и ассетов между собой используются ссылки. Они ссылаются на сущности по уникальным идентификаторам, происходит это автоматически. Это нужно чтобы не искать акторы и их компоненты по пути в коде. Путь может быть нарушен при изменении иерархии, и тогда придется переписывать код. В случае ссылок изменение иерархии не приведет к нарушению ссылок, все будет работать.

Ссылаться можно на другие акторы через `o2::ActorRef` или `o2::Ref<ActorType>`. Точно так же на другие компоненты через `o2::ComponentRef` и `o2::Ref<ComponentType>`. На ассеты можно ссылаться через подобные же `o2::AssetRef` `o2::Ref<AssetType>`.

### Камеры, o2::CameraActor
Это специальные акторы, которые задают отрисовку сцены. Без камеры ничего нарисовано не будет, должна быть хотя бы одна на сцене.

В камере определяется список слоев, которые она рисует. Трансформация камеры задает область видимости в сцене. Работает аналогично камере рендера, своего рода "окно" в пространство сцены.